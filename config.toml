[llm]
base_url = "http://127.0.0.1:8080/v1"
model    = "numind/NuExtract-2.0-8B"
api_key  = "sk-local"
use_grammar = false
max_tokens = 4096
temperature = 0.0

[pdf]
path = "data/concrete.pdf"
max_pages = 40

# =============================================================================
# OPTIMIZED CONFIGURATION 
# =============================================================================

# ---------- PASS A: Structure & Metadata ----------
[task_main]
template_json = """
{
  "pid": "string",
  "study_name": "string",
  "local_name": "string",
  "study_acronym": "string",
  "resource_type": ["string"],
  "cohort_type": "string",
  "study_status": "string",
  "website": "string",
  "start_year": "integer",
  "end_year": "integer",
  "contact_email": "string",
  "n_included": "integer",
  "countries": ["verbatim-string"],
  "regions": ["verbatim-string"],
  "population_age_group": "string",
  "keywords": ["string"]
}
"""

instructions = """
Extract exact values only. Do not infer.

- pid:
  Only if an explicit ID is present (e.g. trial registration, registry ID, database ID).
  Do NOT use acronym as pid. If none → null.

- resource_type:
  Type of RESOURCE (not design, not methodology).
  Allowed only:
  - "cohort"
  - "registry"
  - "biobank"
  - "clinical trial"
  - "database"
  Use only if explicitly stated.

- study_name:
  Official name of the study/cohort.
  If only the paper title is present → null.

- local_name:
  Local / participant-facing name if explicitly mentioned.

- study_acronym:
  Acronym only if explicitly stated.

- cohort_type:
  One of: "Primary care-based", "Hospital-based", "Population-based".

- study_status:
  Only: "ongoing", "completed", "planned" (lowercase). Else null.

- n_included:
  Number of INDIVIDUAL participants. Ignore clusters (GPs, centers).

- countries:
  Use official name, normalize "The Netherlands" → "Netherlands".

- regions:
  Use most specific places mentioned (city/province). Avoid broad regions if specific ones exist.

- population_age_group:
  Copy literal wording if present (e.g. "Men ≥40, women ≥45"), else null.

- keywords:
  Max 10. Only terms that appear verbatim in the text. No generic words.
"""



# ---------- PASS B: Criteria & Design ----------
[task_criteria]
template_json = """
{
  "inclusion_criteria": ["string"],
  "other_inclusion_criteria": ["string"],
  "exclusion_criteria": ["string"],
  "other_exclusion_criteria": ["string"],
  "clinical_study_types": ["string"],
  "type_other": "string",
  "rwd_type": ["string"],
  "network_type": ["string"]
}
"""

instructions = """
Extract eligibility and study type.

- inclusion_criteria:
  List ALL patient eligibility conditions (age, symptoms, condition, care setting).
  Include full clinical context, not only age/sex.
  Ignore eligibility of centers, GPs, hospitals.

- other_inclusion_criteria:
  Administrative requirements only (e.g. insurance, registration).
  If only "informed consent" is mentioned → return [].

- exclusion_criteria:
  Medical/demographic exclusions only.
  Do NOT list outcomes or missing data.

- other_exclusion_criteria:
  Administrative/logistical exclusions only.

- clinical_study_types:
  Select exactly one of:
  - "Randomized Controlled Trial"
  - "Cluster Randomized Trial"
  - "Prospective Cohort"
  - "Registry"

- rwd_type:
  If routine care data, GP records, registries or questionnaires are used, list them here.
  Do NOT leave empty if such data are described.

- network_type:
  List formal networks or consortia ONLY if explicitly named, else [].
"""


# ---------- PASS C: Design & Data Collection ----------
[task_design_details]
template_json = """
{
  "design": ["string"],
  "design_description": "string",
  "data_collection_type": ["string"],
  "data_collection_description": "string",
  "description": "string",
  "time_span_description": "string"
}
"""

instructions = """
- design:
  Select from: ["Longitudinal", "Cross-sectional", "Cohort study", "Randomized Controlled Trial"].
  (Note: Cluster RCT is a type of Randomized Controlled Trial).

- data_collection_description:
  Describe HOW data is captured (e.g. "Web-based questionnaires", "Extraction from Electronic Patient Files").
  **Constraint:** Describe the data gathering method, not the medical treatment.

- description:
  Copy the "Aim" or "Objective" sentence verbatim.
"""

# ---------- PASS D: Population & Samples (STRICT LOGIC) ----------
[task_population]
template_json = """
{
  "number_of_participants_with_samples": "integer|null",
  "underlying_population": "string",
  "population_of_interest": ["string"],
  "population_of_interest_other": "string",
  "part_of_networks": ["string"],
  "population_entry": ["string"],
  "population_entry_other": "string",
  "population_exit": ["string"],
  "population_exit_other": "string",
  "population_disease": ["string"],
  "population_oncology_topology": ["string"],
  "population_oncology_morphology": ["string"],
  "population_coverage": "string",
  "population_not_covered": "string",
  "age_min": "integer",
  "age_max": "integer|null"
}
"""

instructions = """
Extract population details.

- number_of_participants_with_samples:
  Count of individuals with stored PHYSICAL BIOLOGICAL SAMPLES (Blood, DNA, Urine, Tissue).
  If NO explicit stored samples count is given, return null.
  Do NOT reuse total study size. Do NOT count data records or GP practices.

- part_of_networks:
  Return [] unless the text explicitly says "part of", "member of", "network/consortium member".
  If a parent initiative/design name is mentioned WITHOUT explicit membership wording, do NOT include it.

- population_entry:
  Must be an EVENT/PROCESS (invited, enrolled, baseline questionnaire completed, first GP visit, diagnosis).
  If you only find eligibility/location criteria (e.g. "living in Coevorden"), return [].

- population_exit:
  Only if explicit (e.g. "withdrawal of consent", "lost to follow-up").
  If not explicit, return [].

- population_disease:
  List ALL primary disease categories mentioned. If none, [].

- age_max:
  If "no upper limit" or ">=X", return null. Do NOT invent.
"""


# ---------- PASS E: Access & Governance ----------
[task_access]
template_json = """
{
  "informed_consent_type": "string",
  "informed_consent_required": "string",
  "informed_consent_other": "string",
  "access_rights": "string",
  "data_access_conditions": ["string"],
  "data_use_conditions": ["string"],
  "data_access_conditions_description": "string",
  "data_access_fee": "boolean",
  "access_identifiable_data": "string",
  "access_identifiable_data_route": "string",
  "access_subject_details": "boolean",
  "access_subject_details_route": "string",
  "access_third_party": "boolean",
  "access_third_party_conditions": "string",
  "access_non_eu": "boolean",
  "access_non_eu_conditions": "string"
}
"""

instructions = """
- informed_consent_type:
  **Logic:**
  - If participants must "sign" a form, return "Written".
  - If participants must "object" to be excluded, return "Opt-out".

- access_identifiable_data:
  **Logic:** If text mentions "pseudonymized", "coded", or "privacy protected", return "No".
"""

# ---------- PASS F: Contributors ----------
[task_contributors]
template_json = """
{
  "counts_resource": "string",
  "counts_age_group": "string",
  "organisations_involved_resource": ["string"],
  "organisations_involved_id": ["string"],
  "publisher_resource": "string",
  "publisher_id": "string",
  "creator_resource": "string",
  "creator_id": "string",
  "people_involved_resource": ["string"],
  "contact_point_resource": "string",
  "contact_point_first_name": "string",
  "contact_point_last_name": "string",
  "child_networks": ["string"],
  "parent_networks": ["string"]
}
"""

instructions = """
- counts_resource:
  Description of counts. Do not invent numbers.

- publisher_resource:
  The Research Institution (University/Hospital). 
  **Constraint:** Do NOT return the Journal name.

- creator_resource:
  The Organization. 
  **Constraint:** Do NOT return the study acronym.

- people_involved_resource:
  List authors. Ensure correct spelling (check for OCR errors).
"""

# ---------- PASS G: Data Model ----------
[task_datamodel]
template_json = """
{
  "datasets_resource": ["string"],
  "datasets_name": ["string"],
  "samplesets_resource": ["string"],
  "samplesets_name": ["string"],
  "areas_of_information": ["string"],
  "areas_of_information_rwd": ["string"],
  "quality_of_life_measures": ["string"],
  "cause_of_death_vocabulary": "string",
  "indication_vocabulary": "string",
  "genetic_data_vocabulary": "string",
  "care_setting_description": "string",
  "medicinal_product_vocabulary": "string",
  "prescriptions_vocabulary": "string",
  "dispensings_vocabulary": "string",
  "procedures_vocabulary": "string",
  "biomarker_data_vocabulary": "string",
  "diagnosis_medical_event_vocabulary": "string",
  "data_dictionary_available": "boolean",
  "disease_details": ["string"]
}
"""

instructions = """
Extract data standards.
- diagnosis_medical_event_vocabulary: e.g. ICPC, ICD-10.
- quality_of_life_measures: e.g. EQ-5D, SF-36, HeartQoL.
"""

# ---------- PASS H: Biobank Updates ----------
[task_biobank_updates]
template_json = """
{
  "biospecimen_access": "boolean",
  "biospecimen_access_conditions": "string",
  "governance_details": "string",
  "approval_for_publication": "boolean",
  "release_type": "string",
  "release_description": "string",
  "number_of_records": "integer",
  "release_frequency_months": "integer",
  "refresh_time_days": "integer",
  "lag_time_days": "integer",
  "refresh_period": ["string"],
  "date_last_refresh": "string",
  "preservation_indefinite": "boolean",
  "preservation_duration_years": "integer"
}
"""

instructions = """
Extract logistics.

IMPORTANT GATING RULE:
If the study does NOT collect or store biological samples,
then:
- biospecimen_access = false
- ALL other fields in this block MUST be null.
Do NOT infer biobank logistics from data-only studies.
"""

# ---------- PASS I: Quality & SOPs ----------
[task_quality]
template_json = """
{
  "standard_operating_procedures": "boolean",
  "qualification": "boolean",
  "qualifications_description": "string",
  "audit_possible": "boolean",
  "completeness": "string",
  "completeness_over_time": "string",
  "completeness_results": "string",
  "quality_description": "string",
  "quality_over_time": "string",
  "access_for_validation": "boolean",
  "quality_validation_frequency": "string",
  "quality_validation_methods": "string",
  "correction_methods": "string",
  "quality_validation_results": "string",
  "quality_marks": ["string"]
}
"""

instructions = """
Extract quality control details.

- standard_operating_procedures:
  **Logic:** Return **true** if text mentions:
  - "SOPs" / "Standard Operating Procedures"
  - "Protocol" / "Guidelines"
  - "Declaration of Helsinki" / "WMO" / "CONSORT"
  - "Ethics approval"
"""

# ---------- PASS J: Linkage & Specs ----------
[task_linkage_specs]
template_json = """
{
  "biospecimen_collected": ["string"],
  "languages": ["string"],
  "multiple_entries": "boolean",
  "has_identifier": "boolean",
  "identifier_description": "string",
  "prelinked": "boolean",
  "linkage_options": "string",
  "linkage_possibility": "boolean",
  "linked_resources_names": ["string"]
}
"""

instructions = """
- biospecimen_collected:
  List sample types (Blood, DNA) ONLY if explicitly collected and stored.
  **Constraint:** If text only mentions "data collection" or "medical records", return [].

- languages:
  Infer "nl" if study is in Netherlands, "en" if UK/USA.

- has_identifier:
  Return true ONLY if the paper explicitly states that participants or records are assigned a unique, persistent identifier
  that enables record-level linkage over time.

  Examples:
  - explicit subject ID
  - registry-specific patient identifier
  - coded identifier enabling longitudinal linkage

  Do NOT return true based solely on:
  - electronic patient files
  - anonymized data
  - publication identifiers (DOI, trial registration number)
"""

# ---------- PASS K: Triggers ----------
[task_triggers_subpops]
template_json = """
{
  "reason_sustained": "string",
  "record_trigger": "string",
  "unit_of_observation": "string",
  "subpopulations_resource": ["string"],
  "subpopulations_name": ["string"],
  "collection_events_resource": ["string"],
  "collection_events_name": ["string"],
  "data_resources_included": ["string"]
}
"""

instructions = """
- record_trigger:
  The clinical event that adds a PATIENT to the study (e.g. "First consultation", "Diagnosis").
  **Constraint:** Do not describe how GP offices are recruited.

- unit_of_observation:
  "Patient" or "Individual".
  **Constraint:** Even if Cluster Randomized, the unit of observation is usually the Patient.
"""

# ---------- PASS L: CDM & Funding ----------
[task_cdm_funding]
template_json = """
{
  "cdm_mapping_source": ["string"],
  "cdm_mapping_source_dataset": ["string"],
  "cdm_mapping_target": ["string"],
  "cdm_mapping_target_dataset": ["string"],
  "cdm_other": "string",
  "etl_vocabularies": ["string"],
  "etl_vocabularies_other": ["string"],
  "publications": [
    {
      "resource_title": "string",
      "doi": "string"
    }
  ],
  "funding_sources": ["string"],
  "funding_scheme": ["string"],
  "funding_statement": "string"
}
"""

instructions = """
Extract Funding and Data Models.
"""

# ---------- PASS M: Documentation ----------
[task_docs_legislation_dates]
template_json = """
{
  "citation_requirements": "string",
  "acknowledgements": "string",
  "provenance_statement": "string",
  "documentation": [
    {
      "name": "string",
      "resource": "string"
    }
  ],
  "internal_identifiers": [
    {
      "resource": "string",
      "identifier": "string"
    }
  ],
  "external_identifiers": [
    {
      "resource": "string",
      "identifier": "string"
    }
  ],
  "supplementary_information": "string",
  "theme": ["string"],
  "applicable_legislation": ["string"],
  "collection_start_planned": "string",
  "collection_start_actual": "string",
  "analysis_start_planned": "string",
  "analysis_start_actual": "string",
  "metadata_issued": "string",
  "metadata_modified": "string"
}
"""

instructions = """
Extract Dates and Legislation.
"""

# ---------- PASS N: Content ----------
[task_study_content]
template_json = """
{
  "data_sources": ["string"],
  "medical_conditions_studied": ["string"],
  "data_extraction_date": "string",
  "analysis_plan": "string",
  "objectives": "string",
  "results": "string"
}
"""

instructions = """
Extract Content.
- data_sources: e.g. "Electronic registration system", "Questionnaires".
- objectives: Primary aim.
"""
